<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		.cell {
			background-color: grey;
			float: left;
			width: 50px;
			height: 50px;
			border: black solid 1px;
		}

		.first {
			clear: left;
		}

		.brikke {
			background-color: green;
		}
	</style>
</head>

<body onkeydown="return current.controlBlock(event)">
	<div id="app"></div>

</body>

<script>
	let appen = document.getElementById("app")
	let gameInter = setInterval(() => current.moveBlock(), 200);

	class game {
		constructor() {
			this._globalArray = [];
			this._matrix = [
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
				[0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
			]
			this._playerScore = 0;
		}

		initGame() {
			for (let i = 0; i < this._matrix.length; i++) {
				for (let j = 0; j < this._matrix[i].length; j++) {
					let cell = new cells(i, j)
					this._globalArray.push(cell)
				}
			}
		}
		tegneOpp() {
			let html = ""
			for (let i = 0; i < this._matrix.length; i++) {
				for (let j = 0; j < this._matrix[i].length; j++) {
					let first = j % 10 == 0 ? "first" : "";
					let occupied = this._matrix[i][j] == 1 ? "brikke" : "";
					html += `<div class="cell ${occupied} ${first}"></div>`
				}
			}
			appen.innerHTML = html;
		}


	}
	//celler
	class cells {
		constructor(indexy, indexx) {
			this._index = { x: indexx, y: indexy }
			this._isOccupied = 0;
		}
	}
	class currentBlock {
		constructor() {
			this._currentBlock = {
				position: { x: 5, y: 0 }
			};
			this.placeBlock();
		}
		placeBlock() {
			spillet._matrix[this._currentBlock.position.y][this._currentBlock.position.x] = 1
		}
		moveBlock() {
			if (!this._currentBlock.direction) return;
			this._lastPosition = {
				x: this._currentBlock.position.x,
				y: this._currentBlock.position.y,
			}
			if (this._currentBlock.position.y + this._currentBlock.direction.y == 19) {
				this.freezeBlock();
				return;
			}
			if (this._currentBlock.direction.x != 0) {
				if (this._currentBlock.position.x + this._currentBlock.direction.x < 0 || this._currentBlock.position.x + this._currentBlock.direction.x > 9) {
					this._currentBlock.direction.x = 0;
					this._currentBlock.position.y = this._currentBlock.position.y + this._currentBlock.direction.y;
				} else {
					this._currentBlock.position = {
						x: this._currentBlock.position.x + this._currentBlock.direction.x,
						y: this._currentBlock.position.y + this._currentBlock.direction.y
					};
				}

				this._currentBlock.direction.x = 0;
				this.removeLast();
				this.placeBlock();

			} else {
				this._currentBlock.position = {
					x: this._currentBlock.position.x + this._currentBlock.direction.x,
					y: this._currentBlock.position.y + this._currentBlock.direction.y
				};
				this.removeLast();
				this.placeBlock();
			}
			this._lastPosition = 0;
			spillet.tegneOpp();

		}
		controlBlock(e) {
			if (e.keyCode == 37) { // left
				this._currentBlock.direction = { x: -1, y: 1 };
			} else if (e.keyCode == 38) { //rotate
				this.rotate();
			} else if (e.keyCode == 39) { // right
				this._currentBlock.direction = { x: 1, y: 1 };
			} else if (e.keyCode == 40) { // down
				this._currentBlock.direction = { x: 0, y: 1 };
			}
		}
		removeLast() {
			spillet._matrix[this._lastPosition.y][this._lastPosition.x] = 0;
		}
		freezeBlock() {
			this._currentBlock.position.y = 19;
			this._currentBlock.direction.y = 0;
			this._currentBlock.direction.x = 0;
			this.placeBlock();
			this.removeLast();
			delete this._currentBlock;
			this._currentBlock = new currentBlock;
			console.log(this._currentBlock)
			this.moveBlock();
			spillet.tegneOpp();
		}
	}

	class brikke {
		constructor() {
			this._type = this.getRandomType();
		}
		getRandomType() {
			let randomNum = Math.floor(Math.random() * 6)
			if (randomNum === 1) {
				this._matrix = [
					[1, 1, 0],
					[1, 1, 0],
					[0, 0, 0]];
				this._turnType = "block"
			} if (randomNum === 2) {
				this._matrix = [
					[1, 0, 0],
					[1, 0, 0],
					[1, 1, 0]];
				this._turnType = "l-shaped"
			} if (randomNum === 3) {
				this._matrix = [
					[0, 1, 0],
					[1, 1, 1],
					[0, 0, 0]];
				this._turnType = "t-shaped"
			} if (randomNum === 4) {

			} if (randomNum === 5) {

			} if (randomNum === 6) {

			}
		}
		placeIntoMatrix() {
			this._type._matrix
		}
	}
	var spillet = new game;
	spillet.initGame();
	var current = new currentBlock;
	spillet.tegneOpp();
	console.log(spillet._globalArray)
</script>

</html>